- name: Create or Update Pull Request
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        run: |
          TAG="${{ steps.sync.outputs.tag }}"
          TITLE="chore: sync upstream release $TAG"
          HEAD="upstream-sync"
          BASE="main"

          # 1. é¢„æ£€æŸ¥ï¼šå¦‚æœ main å·²ç»åŒ…å«è¯¥ç‰ˆæœ¬ï¼Œåˆ™æ— éœ€æ PR
          git fetch origin $BASE
          if git merge-base --is-ancestor upstream-sync origin/$BASE; then
             echo "âœ… Success: Main branch already contains release $TAG. Skipping PR."
             exit 0
          fi

          # 2. å‡†å¤‡ PR æè¿°
          BODY=$(cat <<EOF
          ## ğŸ”„ ä¸Šæ¸¸ç‰ˆæœ¬åŒæ­¥ $TAG

          æ ¹æ®ä¸‰åˆ†æ”¯æ¨¡å‹è‡ªåŠ¨è§¦å‘åŒæ­¥ï¼š
          **Official (lobehub/lobehub)** -> \`upstream-sync\` -> \`main\`

          æ­¤ PR å·²ç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆï¼Œæ—¨åœ¨å°†å®˜æ–¹æœ€æ–°å‘å¸ƒçš„ä»£ç åˆå¹¶å…¥ç”Ÿäº§åˆ†æ”¯ã€‚
          è¯·åœ¨åˆå¹¶å‰æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰é€»è¾‘å†²çªã€‚
          EOF
          )

          # ã€æ–°å¢æ­¥éª¤ã€‘é˜²å¾¡æ€§åˆ›å»ºæ ‡ç­¾ï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå·²å­˜åœ¨åˆ™å¿½ç•¥é”™è¯¯
          gh label create sync --color 0052cc --description "Sync from upstream" || true
          gh label create upstream --color 0052cc --description "Upstream updates" || true

          # 3. æœç´¢æ˜¯å¦å­˜åœ¨å·²å¼€å¯çš„åŒæ­¥ PR
          EXISTING_PR=$(gh pr list --head $HEAD --base $BASE --state open --json number -q '.[0].number')

          if [ -n "$EXISTING_PR" ]; then
            echo "ğŸ”„ Updating existing PR #$EXISTING_PR..."
            gh pr edit "$EXISTING_PR" --title "$TITLE" --body "$BODY"
            echo "âœ… PR successfully updated."
          else
            echo "ğŸ†• Creating new synchronization PR..."
            # å¦‚æœæ­¤æ—¶ä¾ç„¶æŠ¥æ ‡ç­¾é”™ï¼Œå®ƒä¼šç›´æ¥åˆ›å»º PR è€Œä¸æŒ‚æ‰
            gh pr create --title "$TITLE" --body "$BODY" --head $HEAD --base $BASE --label "sync,upstream" || \
            gh pr create --title "$TITLE" --body "$BODY" --head $HEAD --base $BASE
            echo "âœ… PR successfully created."
          fi
